webpackJsonp([5],{156:function(t,e,i){"use strict";var a=i(1),c=i(7),n=i(11),r=i(12),l=i(2).redirect,s=i(8),d=i(6).StoreWatchMixin,o=a.createClass({displayName:"CityIndexItem",cityClick:function(t){var e=this;e.props.onClick(t)},render:function(){var t=this,e=_.map(t.props.cityIndexData,function(e){return a.createElement("li",{className:"city-item-detail","data-cityid":e.id,onClick:t.cityClick,key:e.id},e.name)});return a.createElement("div",null,a.createElement("div",{className:"city-index-title","data-navid":t.props.indexName},t.props.indexName),a.createElement("div",{className:"city-index-detail"},a.createElement("ul",{className:"list-unstyled"},e)))}}),y=a.createClass({displayName:"GprsCity",cityClick:function(t){var e=this;e.props.onClick(t)},getInitialState:function(){return{cityId:10,cityName:"深圳"}},getCurrent:function(){var t=this;navigator.geolocation.getCurrentPosition(function(e){n.get("/v4/api/city/locate").query({latitude:e.coords.latitude,longitude:e.coords.longitude}).end(function(e,i){!e&&i.body&&0===i.body.status&&t.state.cityName!==i.body.data.city.name&&t.setState({cityId:c.get(i,"body.data.city.id")||10,cityName:c.get(i,"body.data.city.name")||"深圳"})})})},componentDidMount:function(){var t=this;navigator.geolocation?t.getCurrent():n.get("/v4/api/city/locate").end(function(e,i){!e&&i.body&&0==i.body.status&&t.setState({cityId:c.get(i,"body.data.city.id")||10,cityName:c.get(i,"body.data.city.name")||"深圳"})})},render:function(){var t=this;return a.createElement("div",{className:"gprs-city"},a.createElement("div",{className:"city-index-title","data-navid":"gpr"},"GPS定位你所在城市"),a.createElement("div",{className:"city-index-detail"},a.createElement("ul",{className:"list-unstyled"},a.createElement("li",{className:"city-item-detail city-item-detail-gprs","data-cityid":t.state.cityId||10,onClick:t.cityClick},t.state.cityName||"深圳"))))}}),m=a.createClass({displayName:"HotCity",cityClick:function(t){var e=this;e.props.onClick(t)},render:function(){var t=this;return a.createElement("div",{className:"hot-city"},a.createElement("div",{className:"city-index-title","data-navid":"hot"},"热门城市"),a.createElement("div",{className:"city-index-detail"},a.createElement("ul",{className:"list-unstyled"},a.createElement("li",{className:"city-item-detail","data-cityid":"12",onClick:t.cityClick},"北京"),a.createElement("li",{className:"city-item-detail","data-cityid":"11",onClick:t.cityClick},"上海"),a.createElement("li",{className:"city-item-detail","data-cityid":"13",onClick:t.cityClick},"广州"),a.createElement("li",{className:"city-item-detail","data-cityid":"10",onClick:t.cityClick},"深圳"))))}}),u=a.createClass({displayName:"CitySortedByPinYin",cityClick:function(t){var e=this;e.props.onClick(t)},getFirstLetterInWord:function(t){return(t||"").charAt(0).toUpperCase()},render:function(){var t,e=this,i="",c={},n=[],r=[];return _.each(e.props.cities,function(t){i=e.getFirstLetterInWord(t.pinyin),i&&(c[i]||(n.push(i),c[i]=[]),c[i].push(t))}),n=_.sortBy(n),_.each(n,function(t){r.push(c[t])}),t=_.map(r,function(t,i){var c=n[i];return a.createElement(o,{indexName:c,cityIndexData:t,key:c,onClick:e.cityClick})}),a.createElement("div",{className:"index-city"},a.createElement(p,{letter:n}),a.createElement("div",{className:"index-city-list"},t))}}),p=a.createClass({displayName:"LetterIndex",letterClick:function(t){var e,i=$(t.currentTarget),a=i.data("navid"),c=$(".city-index-title");_.forEach(c,function(t){if($(t).data("navid")==a)return e=$(t)}),$("html, body").scrollTop(0,0).animate({scrollTop:e.offset().top-51},300)},componentDidMount:function(){},render:function(){var t,e=this,i=e.props.letter;return t=_.map(i,function(t){return a.createElement("li",{className:"city-item-detail","data-navid":t,onClick:e.letterClick,key:t},t)}),a.createElement("div",null,a.createElement("div",{className:"city-index-title"},"按字母排序"),a.createElement("div",{className:"city-index-detail"},a.createElement("ul",{className:"list-unstyled"},t)))}}),C=a.createClass({displayName:"CityListView",mixins:[s,d("CardStore")],getStateFromFlux:function(){return{card:this.getFlux().store("CardStore").getQueryResult()}},cityClick:function(t){var e=$(t.currentTarget),i=e.data("cityid")||0;return this.props.id?(this.getFlux().actions.card.setCity({id:i,name:e.html()}),l("#!/card/"+this.props.id+"/cinema",{trigger:!0,replace:!0})):void n.post("/v4/api/city/"+i).end(function(t,e){if(0==c.get(e,"body.status"))return l("/v4/")})},getInitialState:function(){return{cities:[]}},componentWillMount:function(){if(this.props.id&&_.isEmpty(this.state.card))return l("#!/card")},componentDidMount:function(){var t=this;r.start(),n.get("/v4/api/city").end(function(e,i){var a=c.get(i,"body.data.cities")||{};r.done(),a&&t.setState({cities:a})}),this.getFlux().actions.application.setNavbar({title:"选择城市"})},render:function(){var t=this;return a.createElement("section",{className:"content city-view"},a.createElement(y,{onClick:t.cityClick}),a.createElement(m,{onClick:t.cityClick}),a.createElement(u,{cities:t.state.cities,onClick:t.cityClick}))}});t.exports=C}});